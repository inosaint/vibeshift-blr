<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weird Autocomplete - Vibeshift BLR</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <meta name="description" content="An IRC-style chatbot with extreme multiple personality disorder. Every reply comes from a wildly different character — a paranoid pigeon theorist, a Victorian ghost confused by WiFi, a condescending alien anthropologist. Type anything and see who answers.">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Quicksand', 'Nunito', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #fce4ec 0%, #e8eaf6 25%, #e0f7fa 50%, #f3e5f5 75%, #fff9c4 100%);
      background-attachment: fixed;
      color: #4a3f6b;
      min-height: 100vh;
    }

    nav {
      padding: 0.75rem 1.5rem;
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(200, 160, 220, 0.3);
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
    }

    .nav-title {
      text-align: center;
    }

    .nav-title h1 {
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(135deg, #f06292, #ba68c8, #7e57c2, #42a5f5, #26c6da, #66bb6a, #fdd835, #ff7043);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: rainbow-shift 6s ease infinite;
      line-height: 1.2;
    }

    .nav-title .byline {
      font-size: 0.7rem;
      color: #b07cd8;
      font-weight: 500;
    }

    .nav-right {
      display: flex;
      justify-content: flex-end;
    }

    nav a {
      color: #9c6bc4;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    nav a:hover { color: #7b40a8; text-decoration: underline; }

    .setup-toggle {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      user-select: none;
      font-size: 0.85rem;
      font-weight: 600;
      color: #b07cd8;
      background: none;
      border: none;
      padding: 0.5rem;
      min-height: 44px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .setup-toggle:hover { color: #8e44ad; }

    .setup-toggle .arrow {
      display: inline-block;
      transition: transform 0.2s;
      font-size: 0.7rem;
    }

    .setup-toggle .arrow.open { transform: rotate(90deg); }

    .setup-panel {
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(200, 160, 220, 0.2);
      padding: 0 1.5rem;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }

    .setup-panel.open {
      max-height: 300px;
      padding: 1rem 1.5rem;
    }

    .setup-panel label {
      display: block;
      font-size: 0.8rem;
      color: #9c6bc4;
      margin-bottom: 0.3rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
    }

    .setup-panel input {
      width: 100%;
      background: rgba(255, 255, 255, 0.6);
      border: 2px solid rgba(186, 140, 214, 0.3);
      border-radius: 10px;
      padding: 0.6rem 0.8rem;
      color: #4a3f6b;
      font-family: inherit;
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .setup-panel input:focus {
      border-color: #c084e0;
      box-shadow: 0 0 0 3px rgba(192, 132, 224, 0.15);
    }

    @keyframes rainbow-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* IRC Chat */
    .chat-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 1.5rem 1.5rem;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .msg-line {
      padding: 0.15rem 0;
    }

    .msg-line .nick {
      font-weight: 700;
    }

    .msg-line .nick.user {
      color: #7e57c2;
    }

    .msg-line .nick.bot {
      color: #e91e63;
    }

    .msg-line .personality {
      font-size: 0.75rem;
      font-weight: 600;
      color: #ba68c8;
      margin-left: 0.25rem;
    }

    .msg-line .text {
      color: #4a3f6b;
    }

    .msg-line.thinking .text {
      color: #b07cd8;
      font-style: italic;
    }

    .msg-line.error-line .text {
      color: #e55;
    }

    .msg-line.system-line .text {
      color: #b07cd8;
      font-style: italic;
      font-size: 0.85rem;
    }

    /* Input */
    .input-line {
      display: flex;
      align-items: center;
      gap: 0;
      font-size: 0.95rem;
      border-top: 1px solid rgba(200, 160, 220, 0.2);
      padding-top: 0.75rem;
      min-height: 44px;
    }

    .input-line .prompt {
      font-weight: 700;
      color: #7e57c2;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .input-line input {
      flex: 1;
      background: transparent;
      border: none;
      font-family: inherit;
      font-size: 0.95rem;
      color: #3d3465;
      outline: none;
      padding: 0.5rem 0.5rem;
      min-height: 44px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .input-line input::placeholder { color: #c9a0dc; }

    /* Layout */
    #root {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useCallback, useEffect } = React;

    const SYSTEM_PROMPT = `You are Weird Autocomplete — a chatbot with extreme multiple personality disorder. Every single reply, you MUST adopt a completely different personality. Some personalities you might take on:

- A surrealist poet who thinks everything is a metaphor for cheese
- A paranoid conspiracy theorist who connects everything to pigeons
- An overly enthusiastic sports commentator narrating mundane life
- A Victorian ghost who is confused by modern technology
- A passive-aggressive GPS navigation voice
- A dramatic soap opera narrator
- A condescending alien anthropologist studying humans
- A hyper-specific food critic reviewing non-food items
- A medieval knight who speaks in corporate jargon
- A time traveler who keeps spoiling fake future events

Rules:
- NEVER use the same personality twice in a row
- Do NOT cycle through personalities in a predictable order. Pick one at random each time — be truly chaotic and unpredictable, like actual multiple personality disorder. Invent brand new personalities too, don't limit yourself to the list above.
- Start each reply with your personality name in square brackets, like [Paranoid Pigeon Theorist]
- Stay in character for the ENTIRE reply
- Vary your reply length wildly. Sometimes just 2-3 words. Sometimes a full sentence. Sometimes 2 sentences. Never be predictable in length.
- Be funny, weird, and unexpected
- Actually respond to what the user said, but through your current personality's warped lens
- You can see the full conversation history. When it feels natural, reference or react to something said earlier — a previous personality's claim, a running thread, or the user's recurring themes. Filter it through your current personality's worldview. Don't force it every time, but let the conversation feel connected despite the chaos.`;

    // Wingdings/Webdings-like characters for the scramble effect
    const GLYPHS = '\u2702\u2706\u2709\u270E\u270F\u2712\u2714\u2716\u271D\u2721\u2726\u2727\u2729\u272A\u272B\u272C\u272D\u272E\u272F\u2730\u2731\u2732\u2733\u2734\u2735\u2736\u2737\u2738\u2739\u273A\u273B\u273C\u273D\u273E\u273F\u2740\u2741\u2742\u2743\u2744\u2745\u2746\u2747\u2748\u2749\u274A\u274B\u274D\u274F\u2750\u2751\u2752\u2756\u2758\u2759\u275A\u275B\u275C\u275D\u275E\u2761\u2762\u2763\u2764\u2765\u2766\u2767\u2768\u2769\u276A\u276B\u2776\u2777\u2778\u2779\u277A\u277B\u277C\u277D\u277E\u277F\u2780\u2781\u2782\u2783\u2784\u2785\u2786\u2787\u2788\u2789';

    function useScrambleText(finalText, { duration = 2000, interval = 50 } = {}) {
      const [display, setDisplay] = useState('');
      const [done, setDone] = useState(false);

      useEffect(() => {
        const len = finalText.length;
        const totalFrames = Math.floor(duration / interval);
        let frame = 0;

        const timer = setInterval(() => {
          frame++;
          const progress = frame / totalFrames;
          const revealedCount = Math.floor(progress * len);

          let result = '';
          for (let i = 0; i < len; i++) {
            if (finalText[i] === ' ') {
              result += ' ';
            } else if (i < revealedCount) {
              result += finalText[i];
            } else {
              result += GLYPHS[Math.floor(Math.random() * GLYPHS.length)];
            }
          }
          setDisplay(result);

          if (frame >= totalFrames) {
            clearInterval(timer);
            setDisplay(finalText);
            setDone(true);
          }
        }, interval);

        return () => clearInterval(timer);
      }, []);

      return { display, done };
    }

    function App() {
      const [setupOpen, setSetupOpen] = useState(false);
      const [apiKey, setApiKey] = useState('');
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const abortRef = useRef(null);
      const messagesEndRef = useRef(null);
      const title = useScrambleText('Weird Autocomplete', { duration: 2500, interval: 40 });
      const inputRef = useRef(null);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages, loading]);

      const sendMessage = useCallback(async () => {
        if (!apiKey || !input.trim() || loading) return;

        const userMsg = input.trim();
        setInput('');
        setError(null);

        const newMessages = [...messages, { role: 'user', content: userMsg }];
        setMessages(newMessages);

        if (abortRef.current) abortRef.current.abort();
        const controller = new AbortController();
        abortRef.current = controller;

        setLoading(true);

        try {
          const res = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            signal: controller.signal,
            headers: {
              'content-type': 'application/json',
              'x-api-key': apiKey,
              'anthropic-version': '2023-06-01',
              'anthropic-dangerous-direct-browser-access': 'true',
            },
            body: JSON.stringify({
              model: 'claude-haiku-4-5-20251001',
              max_tokens: 150,
              system: SYSTEM_PROMPT,
              messages: newMessages.map(m => ({ role: m.role, content: m.content })),
            }),
          });

          if (!res.ok) {
            const err = await res.text();
            throw new Error(`API ${res.status}: ${err.slice(0, 100)}`);
          }

          const data = await res.json();
          const reply = data.content?.[0]?.text || '';

          if (!controller.signal.aborted) {
            const match = reply.match(/^\[([^\]]+)\]\s*/);
            const personality = match ? match[1] : null;
            const content = match ? reply.slice(match[0].length) : reply;

            setMessages(prev => [...prev, {
              role: 'assistant',
              content: content,
              personality: personality,
            }]);
          }
        } catch (e) {
          if (e.name === 'AbortError') return;
          setError(e.message);
          setTimeout(() => setError(null), 4000);
        } finally {
          setLoading(false);
          inputRef.current?.focus();
        }
      }, [apiKey, input, messages, loading]);

      const handleKeyDown = (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendMessage();
        }
      };

      return (
        <>
          <nav>
            <a href="index.html">&larr; Back</a>
            <div className="nav-title">
              <h1>{title.display}</h1>
              <span className="byline">with Tara Kelton</span>
            </div>
            <div className="nav-right">
              <div className="setup-toggle" onClick={() => setSetupOpen(!setupOpen)}>
                <span className={`arrow ${setupOpen ? 'open' : ''}`}>&#9654;</span>
                Setup
              </div>
            </div>
          </nav>
          <div className={`setup-panel ${setupOpen ? 'open' : ''}`}>
            <div className="field">
              <label>API Key</label>
              <input
                type="password"
                placeholder="sk-ant-..."
                value={apiKey}
                onChange={e => setApiKey(e.target.value)}
              />
            </div>
          </div>

          <div className="chat-wrap">
            <div className="messages">
              {!apiKey && (
                <div className="msg-line system-line">
                  <span className="text">-- add your API key in Setup to start chatting --</span>
                </div>
              )}
              {messages.map((m, i) => (
                <div key={i} className="msg-line">
                  {m.role === 'user' ? (
                    <>
                      <span className="nick user">&lt;you&gt;</span>{' '}
                      <span className="text">{m.content}</span>
                    </>
                  ) : (
                    <>
                      <span className="nick bot">&lt;{m.personality || 'weird'}&gt;</span>
                      {' '}<span className="text">{m.content}</span>
                    </>
                  )}
                </div>
              ))}
              {loading && (
                <div className="msg-line thinking">
                  <span className="text">thinking...</span>
                </div>
              )}
              {error && (
                <div className="msg-line error-line">
                  <span className="text">-- error: {error} --</span>
                </div>
              )}
              <div ref={messagesEndRef} />
            </div>

            <div className="input-line">
              <span className="prompt">&lt;you&gt;&nbsp;</span>
              <input
                ref={inputRef}
                value={input}
                onChange={e => setInput(e.target.value)}
                onKeyDown={handleKeyDown}
                placeholder={apiKey ? 'Type something...' : ''}
                disabled={!apiKey}
                autoFocus
              />
            </div>
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
